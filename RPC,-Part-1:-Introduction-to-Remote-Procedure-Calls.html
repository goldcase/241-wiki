<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
	<link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
</head>
<body>
<h2>What is RPC?</h2>
<p>Remote Procedure Call. RPC is the idea that we can execute a procedure (function) on a different machine. In practice the procedure may execute on the same machine, however it may be in a different context - for example under a different user with different permissions and different lifecycle.</p>
<h2>What is Privilege Separation?</h2>
<p>The remote code will execute under a different user and with different privileges from the caller. In practice the remote call may execute with more or fewer privileges than the caller. This in principle can be used to improve the security of a system (by ensuring components operate with least privilege). Unfortunately, security concerns need to be carefully assessed to ensure that RPC mechanisms cannot be subverted to perform unwanted actions. For example, an RPC implementation may implicitly trust any connected client to perform any action, rather than a subset of actions on a subset of the data.</p>
<h2>What is stub code? What is marshalling?</h2>
<p>The stub code is the necessary code to hide the complexity of performing a remote procedure call. One of the roles of the stub code is to <em>marshall</em> the necessary data into a format that can be sent as a byte stream to a remote server.</p>
<div class="highlight"><pre><span class="c1">// On the outside &#39;getHiscore&#39; looks like a normal function call</span>
<span class="c1">// On the inside the stub code performs all of the work to send and receive the data to and from the remote machine.</span>

<span class="kt">int</span> <span class="nf">getHiscore</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">game</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Marshall the request into a sequence of bytes:</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span><span class="p">;</span>
  <span class="n">asprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span><span class="s">&quot;getHiscore(%s)!&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>

  <span class="c1">// Send down the wire (we do not send the zero byte; the &#39;!&#39; signifies the end of the message)</span>
  <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="p">);</span>

  <span class="c1">// Wait for the server to send a response</span>
  <span class="kt">ssize_t</span> <span class="n">bytesread</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>

  <span class="c1">// Example: unmarshal the bytes received back from text into an int</span>
  <span class="n">buffer</span><span class="p">[</span><span class="n">bytesread</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Turn the result into a C string</span>

  <span class="kt">int</span> <span class="n">score</span><span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">score</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h2>What is server stub code? What is unmarshalling?</h2>
<p>The server stub code will receive the request, unmarshall the request into a valid in-memory data call the underlying implementation and send the result back to the caller.</p>
<h2>How do you send an int? float? a struct?  A linked list? A graph?</h2>
<p>To implement RPC you need to decide (and document) which conventions you will use to serialize the data into a byte sequence. Even a simple integer has several common choices:<br />
<em> Signed or unsigned?<br />
</em> ASCII<br />
<em> Fixed number of bytes or variable depending on magnitude<br />
</em> Little or Big endian binary format?</p>
<p>To marshall a struct, decide which fields need to be serialized. It may not be necessary to send all data items (for example, some items may be irrelevant to the specific RPC or can be re-computed by the server from the other data items present).</p>
<p>To marshall a linked list it is unnecessary to send the link pointers- just stream the values. As part of unmarshalling the server can recreate a linked list structure from the byte sequence.</p>
<p>By starting at the head node/vertex, a simple tree can be recursively visited to create a serialized version of the data. A cyclic graph will usually require additional memory to ensure that each edge and vertex is processed exactly once.</p>
<h2>What is an IDL (Interface Design Language)?</h2>
<p>Writing stub code by hand is painful, tedious, error prone, difficult to maintain and difficult to reverse engineer the wire protocol from the implemented code. A better approach is specify the data objects, messages and services and automatically generate the client and server code.</p>
<p>A modern example of an Interface Design Language is Google's Protocol Buffer .proto files.</p>
<h2>Complexity and challenges of RPC vs local calls?</h2>
<p>Remote Procedure Calls are significantly slower (10x to 100x) and more complex than local calls. An RPC must marshall data into a wire-compatible format. This may require multiple passes through the data structure, temporary memory allocation and transformation of the data representation.</p>
<p>Robust RPC stub code must intelligently handle network failures and versioning. For example, a server may have to process requests from clients that are still running an early version of the stub code.</p>
<p>A secure RPC will need to implement additional security checks (including authentication and authorization), validate data and encrypt communication between the client and host.</p>
<h2>Transferring large amounts of structured data</h2>
<p>Let's examine three methods of transferring data using 3 different formats - JSON, XML and Google Protocol Buffers. JSON and XML are text-based protocols. Examples of JSON and XML messages are below.</p>
<div class="highlight"><pre><span class="nt">&lt;ticket&gt;&lt;price</span> <span class="na">currency=</span><span class="s">&#39;dollar&#39;</span><span class="nt">&gt;</span>10<span class="nt">&lt;/price&gt;&lt;vendor&gt;</span>travelocity<span class="nt">&lt;/vendor&gt;&lt;/ticket&gt;</span>
</pre></div>


<div class="highlight"><pre><span class="p">{</span> <span class="s1">&#39;currency&#39;</span><span class="o">:</span><span class="s1">&#39;dollar&#39;</span> <span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="o">:</span><span class="s1">&#39;travelocity&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="o">:</span><span class="s1">&#39;10&#39;</span> <span class="p">}</span>
</pre></div>


<p>Google Protocol Buffers is an open-source efficient binary protocol that places a strong emphasis on high throughput with low CPU overhead and minimal memory copying. Implementations exist for multiple languages including Go, Python, C++ and C. This means client and server stub code in multiple languages can be generated from the .proto specification file to marshall data to and from a binary stream.</p>
<p>Google Protocol Buffers reduces the versioning problem by ignoring unknown fields that are present in a message. See the introduction to Protocol Buffers for more information.</p>
<p>[[<a href="https://developers.google.com/protocol-buffers/docs/overview">https://developers.google.com/protocol-buffers/docs/overview</a>]]</p>
    <script src="check_mc.js"></script>
</body>
</html>
</body>
</html>
